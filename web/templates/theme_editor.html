<!-- 
    Dosya: theme_editor.html
    Son G√ºncelleme: 06 Mayƒ±s 2025
    Versiyon: 0.5.1
    
    Bu ≈üablon dosyasƒ± FACE1 robot y√ºz projesindeki tema edit√∂r aray√ºz√ºn√º saƒülar.
    Kullanƒ±cƒ± burada robotun g√∂z, aƒüƒ±z ve LED ifadelerini duygu durumlarƒ±na g√∂re
    √∂zelle≈ütirebilir ve temayƒ± kaydedebilir.
-->
<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
    <title>FACE1 Tema Edit√∂r√º</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Tema ve eri≈üilebilirlik CSS dosyalarƒ± -->
    <link rel="stylesheet" href="/static/css/theme/theme-variables.css">
    <link rel="stylesheet" href="/static/css/theme/responsive.css">
    <link rel="stylesheet" href="/static/css/theme/accessibility.css">
    <!-- Ana stil dosyasƒ± -->
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* Tema edit√∂r√º √∂zel stilleri */
        .theme-editor {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: calc(var(--f1-spacing-unit, 8px) * 2);
        }

        .sidebar {
            background-color: var(--f1-card-background, #f0f4f8);
            padding: var(--f1-spacing-unit, 8px) * 2;
            border-radius: var(--f1-border-radius, 8px);
            box-shadow: var(--f1-panel-shadow, 0 2px 4px rgba(0,0,0,0.1));
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            padding: calc(var(--f1-spacing-unit, 8px)) 0;
            border-bottom: 1px solid var(--f1-border-color, #e0e0e0);
            cursor: pointer;
        }

        .sidebar li.active {
            font-weight: bold;
            color: var(--f1-primary-color, var(--primary-color));
        }

        .editor-main {
            background-color: var(--f1-card-background, white);
            padding: calc(var(--f1-spacing-unit, 8px) * 2);
            border-radius: var(--f1-border-radius, 8px);
            box-shadow: var(--f1-panel-shadow, 0 2px 4px rgba(0,0,0,0.1));
        }

        .editor-section {
            display: none;
            margin-bottom: calc(var(--f1-spacing-unit, 8px) * 4);
        }

        .editor-section.active {
            display: block;
        }

        .theme-preview {
            margin: calc(var(--f1-spacing-unit, 8px) * 2) 0;
            padding: calc(var(--f1-spacing-unit, 8px) * 2);
            background-color: #f9f9f9;
            border: 1px solid var(--f1-border-color, #e0e0e0);
            border-radius: var(--f1-border-radius, 8px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .preview-face {
            width: 220px;
            height: 270px;
            background-color: #f0f0f0;
            border-radius: 50% 50% 40% 40%;
            position: relative;
            margin: 1rem auto;
            border: 2px solid #ddd;
        }

        .form-row {
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }

        .form-row label {
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
        }

        .color-picker input[type="text"] {
            width: 80px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
        }

        .emotion-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .emotion-tab {
            padding: 0.5rem 1rem;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }

        .emotion-tab.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .theme-metadata {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- Ekran okuyucular i√ßin atlama linki -->
    <a href="#main-content" class="f1-skip-link">Ana i√ßeriƒüe atla</a>
    
    <header>
        <h1>FACE1 Robot Tema Edit√∂r√º</h1>
        <div class="header-actions">
            <a href="/" class="f1-button">Ana Sayfaya D√∂n</a>
            
            <!-- Tema deƒüi≈ütirme butonlarƒ± -->
            <div class="f1-theme-toggle">
                <button data-theme-toggle="light" title="A√ßƒ±k tema" class="f1-button">‚òÄÔ∏è</button>
                <button data-theme-toggle="dark" title="Koyu tema" class="f1-button">üåô</button>
                <button data-theme-toggle="high-contrast" title="Y√ºksek kontrast tema" class="f1-button">üîç</button>
            </div>
        </div>
    </header>
    
    <main id="main-content">
        <div class="container">
            <div class="theme-header">
                <h2>{{ theme_name|title }} Temasƒ± D√ºzenleme</h2>
                <p class="description">Tema detaylarƒ±nƒ± ve g√∂rsel √∂ƒüeleri buradan d√ºzenleyebilirsiniz.</p>
            </div>

            <div class="theme-editor">
                <div class="sidebar">
                    <h3>B√∂l√ºmler</h3>
                    <ul>
                        <li class="section-link active" data-section="general">Genel Bilgiler</li>
                        <li class="section-link" data-section="eyes">G√∂z Ayarlarƒ±</li>
                        <li class="section-link" data-section="mouth">Aƒüƒ±z Ayarlarƒ±</li>
                        <li class="section-link" data-section="led">LED Ayarlarƒ±</li>
                        <li class="section-link" data-section="preview">√ñnizleme</li>
                    </ul>
                    
                    <div class="sidebar-actions">
                        <button id="save-theme" class="primary-button">Temayƒ± Kaydet</button>
                        <button id="copy-theme" class="secondary-button">Tema Kopyala</button>
                    </div>
                </div>

                <div class="editor-main">
                    <!-- Genel Bilgiler B√∂l√ºm√º -->
                    <div class="editor-section active" id="section-general">
                        <h3>Genel Tema Bilgileri</h3>
                        <div class="theme-metadata">
                            <div class="form-row">
                                <label for="theme-name">Tema Adƒ±:</label>
                                <input type="text" id="theme-name" value="{{ theme_details.name }}" required>
                            </div>
                            <div class="form-row">
                                <label for="theme-description">A√ßƒ±klama:</label>
                                <textarea id="theme-description" rows="3">{{ theme_details.description }}</textarea>
                            </div>
                            <div class="form-row">
                                <label for="theme-author">Yazar:</label>
                                <input type="text" id="theme-author" value="{{ theme_details.author }}">
                            </div>
                            <div class="form-row">
                                <label for="theme-version">Versiyon:</label>
                                <input type="text" id="theme-version" value="{{ theme_details.version }}">
                            </div>
                        </div>
                    </div>

                    <!-- G√∂z Ayarlarƒ± B√∂l√ºm√º -->
                    <div class="editor-section" id="section-eyes">
                        <h3>G√∂z Ayarlarƒ±</h3>
                        <div class="emotion-tabs">
                            {% for emotion in emotions %}
                            <div class="emotion-tab {% if loop.first %}active{% endif %}" data-emotion="{{ emotion }}">{{ emotion|title }}</div>
                            {% endfor %}
                        </div>

                        {% for emotion in emotions %}
                        <div class="emotion-settings {% if loop.first %}active{% endif %}" id="eyes-{{ emotion }}">
                            <h4>{{ emotion|title }} Duygusu G√∂z Ayarlarƒ±</h4>
                            
                            <div class="form-grid">
                                <div class="form-row">
                                    <label for="eye-style-{{ emotion }}">G√∂z Stili:</label>
                                    <select id="eye-style-{{ emotion }}">
                                        <option value="cartoon" {% if theme_details.eyes[emotion].style == "cartoon" %}selected{% endif %}>√áizgi Film</option>
                                        <option value="minimal" {% if theme_details.eyes[emotion].style == "minimal" %}selected{% endif %}>Minimal</option>
                                        <option value="pixel" {% if theme_details.eyes[emotion].style == "pixel" %}selected{% endif %}>Piksel</option>
                                        <option value="realistic" {% if theme_details.eyes[emotion].style == "realistic" %}selected{% endif %}>Ger√ßek√ßi</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label for="pupil-size-{{ emotion }}">G√∂z Bebeƒüi Boyutu:</label>
                                    <input type="range" id="pupil-size-{{ emotion }}" min="0.1" max="0.8" step="0.05" 
                                        value="{{ theme_details.eyes[emotion].pupil_size }}">
                                    <span id="pupil-size-value-{{ emotion }}">{{ theme_details.eyes[emotion].pupil_size }}</span>
                                </div>
                                <div class="form-row">
                                    <label>G√∂z Bebeƒüi Rengi:</label>
                                    <div class="color-picker">
                                        <input type="color" id="iris-color-picker-{{ emotion }}" 
                                            value="#{{ '%02x%02x%02x' % tuple(theme_details.eyes[emotion].iris_color) }}">
                                        <input type="text" id="iris-color-text-{{ emotion }}" 
                                            value="{{ theme_details.eyes[emotion].iris_color }}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label for="animation-{{ emotion }}">Animasyon:</label>
                                    <select id="animation-{{ emotion }}">
                                        <option value="blink" {% if theme_details.eyes[emotion].animation == "blink" %}selected{% endif %}>G√∂z Kƒ±rpma</option>
                                        <option value="blink_slow" {% if theme_details.eyes[emotion].animation == "blink_slow" %}selected{% endif %}>Yava≈ü G√∂z Kƒ±rpma</option>
                                        <option value="squint" {% if theme_details.eyes[emotion].animation == "squint" %}selected{% endif %}>Kƒ±sƒ±k G√∂z</option>
                                        <option value="wide" {% if theme_details.eyes[emotion].animation == "wide" %}selected{% endif %}>Geni≈ü G√∂z</option>
                                        <option value="look_around" {% if theme_details.eyes[emotion].animation == "look_around" %}selected{% endif %}>Etrafƒ± ƒ∞zle</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label for="blink-rate-{{ emotion }}">G√∂z Kƒ±rpma Hƒ±zƒ±:</label>
                                    <input type="range" id="blink-rate-{{ emotion }}" min="1" max="10" step="0.5" 
                                        value="{{ theme_details.eyes[emotion].blink_rate }}">
                                    <span id="blink-rate-value-{{ emotion }}">{{ theme_details.eyes[emotion].blink_rate }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Aƒüƒ±z Ayarlarƒ± B√∂l√ºm√º -->
                    <div class="editor-section" id="section-mouth">
                        <h3>Aƒüƒ±z Ayarlarƒ±</h3>
                        <div class="emotion-tabs">
                            {% for emotion in emotions %}
                            <div class="emotion-tab {% if loop.first %}active{% endif %}" data-emotion="{{ emotion }}">{{ emotion|title }}</div>
                            {% endfor %}
                        </div>

                        {% for emotion in emotions %}
                        <div class="emotion-settings {% if loop.first %}active{% endif %}" id="mouth-{{ emotion }}">
                            <h4>{{ emotion|title }} Duygusu Aƒüƒ±z Ayarlarƒ±</h4>
                            
                            <div class="form-grid">
                                <div class="form-row">
                                    <label for="mouth-style-{{ emotion }}">Aƒüƒ±z Stili:</label>
                                    <select id="mouth-style-{{ emotion }}">
                                        <option value="smile" {% if theme_details.mouth[emotion].style == "smile" %}selected{% endif %}>G√ºl√ºmseme</option>
                                        <option value="frown" {% if theme_details.mouth[emotion].style == "frown" %}selected{% endif %}>√úzg√ºn</option>
                                        <option value="flat" {% if theme_details.mouth[emotion].style == "flat" %}selected{% endif %}>D√ºz</option>
                                        <option value="o" {% if theme_details.mouth[emotion].style == "o" %}selected{% endif %}>O ≈ûekli</option>
                                        <option value="slight_smile" {% if theme_details.mouth[emotion].style == "slight_smile" %}selected{% endif %}>Hafif G√ºl√ºmseme</option>
                                        <option value="grimace" {% if theme_details.mouth[emotion].style == "grimace" %}selected{% endif %}>Y√ºz Buru≈üturma</option>
                                        <option value="o_small" {% if theme_details.mouth[emotion].style == "o_small" %}selected{% endif %}>K√º√ß√ºk O</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label for="mouth-width-{{ emotion }}">Aƒüƒ±z Geni≈üliƒüi:</label>
                                    <input type="range" id="mouth-width-{{ emotion }}" min="0.2" max="1.0" step="0.05" 
                                        value="{{ theme_details.mouth[emotion].width }}">
                                    <span id="mouth-width-value-{{ emotion }}">{{ theme_details.mouth[emotion].width }}</span>
                                </div>
                                <div class="form-row">
                                    <label for="mouth-height-{{ emotion }}">Aƒüƒ±z Y√ºksekliƒüi:</label>
                                    <input type="range" id="mouth-height-{{ emotion }}" min="0" max="1.0" step="0.05" 
                                        value="{{ theme_details.mouth[emotion].height }}">
                                    <span id="mouth-height-value-{{ emotion }}">{{ theme_details.mouth[emotion].height }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- LED Ayarlarƒ± B√∂l√ºm√º -->
                    <div class="editor-section" id="section-led">
                        <h3>LED Ayarlarƒ±</h3>
                        <div class="emotion-tabs">
                            {% for emotion in emotions %}
                            <div class="emotion-tab {% if loop.first %}active{% endif %}" data-emotion="{{ emotion }}">{{ emotion|title }}</div>
                            {% endfor %}
                        </div>

                        {% for emotion in emotions %}
                        <div class="emotion-settings {% if loop.first %}active{% endif %}" id="led-{{ emotion }}">
                            <h4>{{ emotion|title }} Duygusu LED Ayarlarƒ±</h4>
                            
                            <div class="form-grid">
                                <div class="form-row">
                                    <label>LED Rengi:</label>
                                    <div class="color-picker">
                                        <input type="color" id="led-color-picker-{{ emotion }}" 
                                            value="#{{ '%02x%02x%02x' % tuple(theme_details.led[emotion].color) }}">
                                        <input type="text" id="led-color-text-{{ emotion }}" 
                                            value="{{ theme_details.led[emotion].color }}">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label for="led-pattern-{{ emotion }}">LED Deseni:</label>
                                    <select id="led-pattern-{{ emotion }}">
                                        <option value="static" {% if theme_details.led[emotion].pattern == "static" %}selected{% endif %}>Sabit</option>
                                        <option value="pulse" {% if theme_details.led[emotion].pattern == "pulse" %}selected{% endif %}>Nabƒ±z</option>
                                        <option value="breathe" {% if theme_details.led[emotion].pattern == "breathe" %}selected{% endif %}>Nefes</option>
                                        <option value="wipe" {% if theme_details.led[emotion].pattern == "wipe" %}selected{% endif %}>Silme</option>
                                        <option value="sparkle" {% if theme_details.led[emotion].pattern == "sparkle" %}selected{% endif %}>Parƒ±ldama</option>
                                        <option value="rainbow" {% if theme_details.led[emotion].pattern == "rainbow" %}selected{% endif %}>G√∂kku≈üaƒüƒ±</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label for="led-speed-{{ emotion }}">Animasyon Hƒ±zƒ±:</label>
                                    <input type="range" id="led-speed-{{ emotion }}" min="0" max="100" step="5" 
                                        value="{{ theme_details.led[emotion].speed }}">
                                    <span id="led-speed-value-{{ emotion }}">{{ theme_details.led[emotion].speed }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- √ñnizleme B√∂l√ºm√º -->
                    <div class="editor-section" id="section-preview">
                        <h3>Tema √ñnizleme</h3>
                        <div class="preview-controls">
                            <div class="form-row">
                                <label for="preview-emotion">Duygu Se√ßin:</label>
                                <select id="preview-emotion">
                                    {% for emotion in emotions %}
                                    <option value="{{ emotion }}">{{ emotion|title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="theme-preview">
                            <div class="preview-face">
                                <div class="eyes">
                                    <div class="eye left"></div>
                                    <div class="eye right"></div>
                                </div>
                                <div class="mouth"></div>
                            </div>
                            <div class="preview-led">
                                <div class="led-strip"></div>
                            </div>
                        </div>

                        <div class="simulation-link">
                            <p>Daha detaylƒ± √∂nizleme i√ßin <a href="/" target="_blank">Ana Dashboard</a> sayfasƒ±na gidip tema se√ßimini deƒüi≈ütirebilirsiniz.</p>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button id="reset-theme" class="secondary-button">Deƒüi≈üiklikleri Sƒ±fƒ±rla</button>
                        <button id="save-theme-bottom" class="primary-button">Temayƒ± Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>&copy; 2025 FACE1 Robot - Version 0.5.1</p>
    </footer>

    <div class="f1-modal" id="copy-theme-modal">
        <div class="f1-modal-content">
            <span class="f1-modal-close">&times;</span>
            <h3>Tema Kopyala</h3>
            <p>Yeni tema adƒ±nƒ± giriniz:</p>
            <div class="form-row">
                <input type="text" id="new-theme-name" placeholder="yeni_tema_adƒ±">
            </div>
            <div class="f1-modal-actions">
                <button id="confirm-copy" class="f1-button">Kopyala</button>
                <button class="f1-button modal-close-btn">ƒ∞ptal</button>
            </div>
        </div>
    </div>
    
    <!-- Tema y√∂netici scripti -->
    <script src="/static/js/theme-manager.js"></script>
    <!-- Mevcut scriptler -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elementleri
            const sectionLinks = document.querySelectorAll('.section-link');
            const editorSections = document.querySelectorAll('.editor-section');
            const emotionTabs = document.querySelectorAll('.emotion-tab');
            const emotionSettings = document.querySelectorAll('.emotion-settings');
            const saveButtons = document.querySelectorAll('#save-theme, #save-theme-bottom');
            const copyThemeBtn = document.getElementById('copy-theme');
            const resetThemeBtn = document.getElementById('reset-theme');
            const copyThemeModal = document.getElementById('copy-theme-modal');
            const confirmCopyBtn = document.getElementById('confirm-copy');
            const modalCloseBtns = document.querySelectorAll('.modal-close, .modal-close-btn');
            const originalThemeData = {{ theme_details|tojson|safe }};
            
            let currentThemeData = JSON.parse(JSON.stringify(originalThemeData));
            let hasChanges = false;

            // B√∂l√ºmler arasƒ± ge√ßi≈ü
            sectionLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // Aktif baƒülantƒ±yƒ± i≈üaretle
                    sectionLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ƒ∞lgili b√∂l√ºm√º g√∂ster
                    editorSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(`section-${section}`).classList.add('active');
                });
            });
            
            // Duygu sekmeleri arasƒ± ge√ßi≈ü
            emotionTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const emotion = this.getAttribute('data-emotion');
                    const parentSection = this.closest('.editor-section');
                    const sectionId = parentSection.id;
                    const type = sectionId.replace('section-', '');
                    
                    // Aynƒ± b√∂l√ºmdeki sekmeleri g√ºncelle
                    parentSection.querySelectorAll('.emotion-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ƒ∞lgili duygu ayarlarƒ±nƒ± g√∂ster
                    parentSection.querySelectorAll('.emotion-settings').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${type}-${emotion}`).classList.add('active');
                });
            });
            
            // Range inputlarƒ± i√ßin deƒüer g√∂sterimi
            document.querySelectorAll('input[type="range"]').forEach(input => {
                const valueSpan = document.getElementById(input.id + '-value');
                if (valueSpan) {
                    input.addEventListener('input', function() {
                        valueSpan.textContent = this.value;
                        updateThemeData();
                    });
                }
            });
            
            // Renk se√ßici senkronizasyonu
            document.querySelectorAll('input[type="color"]').forEach(colorInput => {
                const textInput = document.getElementById(colorInput.id.replace('-picker', '-text'));
                
                colorInput.addEventListener('input', function() {
                    const hexColor = this.value;
                    const rgbColor = hexToRgb(hexColor);
                    textInput.value = rgbColor;
                    updateThemeData();
                });
                
                textInput.addEventListener('change', function() {
                    try {
                        const rgbArray = JSON.parse(this.value);
                        const hexColor = rgbToHex(rgbArray);
                        colorInput.value = hexColor;
                        updateThemeData();
                    } catch (e) {
                        console.error('Renk formatƒ± hatalƒ±:', e);
                    }
                });
            });
            
            // Diƒüer inputlar ve selectler i√ßin deƒüi≈üim takibi
            document.querySelectorAll('input[type="text"], textarea, select').forEach(input => {
                input.addEventListener('change', updateThemeData);
            });
            
            // Modal i≈ülevleri
            copyThemeBtn.addEventListener('click', function() {
                copyThemeModal.style.display = 'block';
            });
            
            modalCloseBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    copyThemeModal.style.display = 'none';
                });
            });
            
            // Tema kopyalama i≈ülemi
            confirmCopyBtn.addEventListener('click', async function() {
                const newThemeName = document.getElementById('new-theme-name').value.trim();
                
                if (!newThemeName) {
                    alert('L√ºtfen yeni tema i√ßin bir isim giriniz.');
                    return;
                }
                
                try {
                    const response = await fetch(`/api/themes/{{ theme_name }}/copy/${newThemeName}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        alert(`Tema ba≈üarƒ±yla kopyalandƒ±: ${newThemeName}`);
                        window.location.href = `/theme-editor/${newThemeName}`;
                    } else {
                        alert(`Hata: ${result.detail || 'Tema kopyalanamadƒ±'}`);
                    }
                } catch (e) {
                    alert('Baƒülantƒ± hatasƒ±: ' + e.message);
                } finally {
                    copyThemeModal.style.display = 'none';
                }
            });
            
            // Tema kaydetme i≈ülemi
            saveButtons.forEach(btn => {
                btn.addEventListener('click', async function() {
                    if (!hasChanges) {
                        alert('Hen√ºz bir deƒüi≈üiklik yapƒ±lmadƒ±.');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/api/themes/{{ theme_name }}/edit`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(currentThemeData)
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok) {
                            alert('Tema ba≈üarƒ±yla kaydedildi.');
                            hasChanges = false;
                            // Orijinal veriyi g√ºncelle
                            originalThemeData = JSON.parse(JSON.stringify(currentThemeData));
                        } else {
                            alert(`Hata: ${result.detail || 'Tema kaydedilemedi'}`);
                        }
                    } catch (e) {
                        alert('Baƒülantƒ± hatasƒ±: ' + e.message);
                    }
                });
            });
            
            // Deƒüi≈üiklikleri sƒ±fƒ±rlama
            resetThemeBtn.addEventListener('click', function() {
                if (confirm('T√ºm deƒüi≈üiklikler kaybolacak. Devam etmek istiyor musunuz?')) {
                    resetForm();
                }
            });
            
            // Tema verilerini g√ºncelleme
            function updateThemeData() {
                // Temel bilgiler
                currentThemeData.name = document.getElementById('theme-name').value;
                currentThemeData.description = document.getElementById('theme-description').value;
                currentThemeData.author = document.getElementById('theme-author').value;
                currentThemeData.version = document.getElementById('theme-version').value;
                
                // Duygular i√ßin ayarlarƒ± topla
                const emotions = {{ emotions|tojson|safe }};
                
                emotions.forEach(emotion => {
                    // G√∂z ayarlarƒ±
                    if (currentThemeData.eyes && currentThemeData.eyes[emotion]) {
                        currentThemeData.eyes[emotion].style = document.getElementById(`eye-style-${emotion}`).value;
                        currentThemeData.eyes[emotion].pupil_size = parseFloat(document.getElementById(`pupil-size-${emotion}`).value);
                        currentThemeData.eyes[emotion].iris_color = JSON.parse(document.getElementById(`iris-color-text-${emotion}`).value);
                        currentThemeData.eyes[emotion].animation = document.getElementById(`animation-${emotion}`).value;
                        currentThemeData.eyes[emotion].blink_rate = parseFloat(document.getElementById(`blink-rate-${emotion}`).value);
                    }
                    
                    // Aƒüƒ±z ayarlarƒ±
                    if (currentThemeData.mouth && currentThemeData.mouth[emotion]) {
                        currentThemeData.mouth[emotion].style = document.getElementById(`mouth-style-${emotion}`).value;
                        currentThemeData.mouth[emotion].width = parseFloat(document.getElementById(`mouth-width-${emotion}`).value);
                        currentThemeData.mouth[emotion].height = parseFloat(document.getElementById(`mouth-height-${emotion}`).value);
                    }
                    
                    // LED ayarlarƒ±
                    if (currentThemeData.led && currentThemeData.led[emotion]) {
                        currentThemeData.led[emotion].color = JSON.parse(document.getElementById(`led-color-text-${emotion}`).value);
                        currentThemeData.led[emotion].pattern = document.getElementById(`led-pattern-${emotion}`).value;
                        currentThemeData.led[emotion].speed = parseInt(document.getElementById(`led-speed-${emotion}`).value);
                    }
                });
                
                hasChanges = !compareObjects(originalThemeData, currentThemeData);
                updateSaveButtonState();
            }
            
            // Form alanlarƒ±nƒ± sƒ±fƒ±rlama
            function resetForm() {
                // Mevcut temayƒ± orijinal veriden geri y√ºkle
                currentThemeData = JSON.parse(JSON.stringify(originalThemeData));
                
                // Temel bilgiler
                document.getElementById('theme-name').value = currentThemeData.name;
                document.getElementById('theme-description').value = currentThemeData.description;
                document.getElementById('theme-author').value = currentThemeData.author;
                document.getElementById('theme-version').value = currentThemeData.version;
                
                // Duygular i√ßin ayarlarƒ± y√ºkle
                const emotions = {{ emotions|tojson|safe }};
                
                emotions.forEach(emotion => {
                    // G√∂z ayarlarƒ±
                    if (currentThemeData.eyes && currentThemeData.eyes[emotion]) {
                        document.getElementById(`eye-style-${emotion}`).value = currentThemeData.eyes[emotion].style;
                        document.getElementById(`pupil-size-${emotion}`).value = currentThemeData.eyes[emotion].pupil_size;
                        document.getElementById(`pupil-size-value-${emotion}`).textContent = currentThemeData.eyes[emotion].pupil_size;
                        document.getElementById(`iris-color-text-${emotion}`).value = JSON.stringify(currentThemeData.eyes[emotion].iris_color);
                        document.getElementById(`iris-color-picker-${emotion}`).value = rgbToHex(currentThemeData.eyes[emotion].iris_color);
                        document.getElementById(`animation-${emotion}`).value = currentThemeData.eyes[emotion].animation;
                        document.getElementById(`blink-rate-${emotion}`).value = currentThemeData.eyes[emotion].blink_rate;
                        document.getElementById(`blink-rate-value-${emotion}`).textContent = currentThemeData.eyes[emotion].blink_rate;
                    }
                    
                    // Aƒüƒ±z ayarlarƒ±
                    if (currentThemeData.mouth && currentThemeData.mouth[emotion]) {
                        document.getElementById(`mouth-style-${emotion}`).value = currentThemeData.mouth[emotion].style;
                        document.getElementById(`mouth-width-${emotion}`).value = currentThemeData.mouth[emotion].width;
                        document.getElementById(`mouth-width-value-${emotion}`).textContent = currentThemeData.mouth[emotion].width;
                        document.getElementById(`mouth-height-${emotion}`).value = currentThemeData.mouth[emotion].height;
                        document.getElementById(`mouth-height-value-${emotion}`).textContent = currentThemeData.mouth[emotion].height;
                    }
                    
                    // LED ayarlarƒ±
                    if (currentThemeData.led && currentThemeData.led[emotion]) {
                        document.getElementById(`led-color-text-${emotion}`).value = JSON.stringify(currentThemeData.led[emotion].color);
                        document.getElementById(`led-color-picker-${emotion}`).value = rgbToHex(currentThemeData.led[emotion].color);
                        document.getElementById(`led-pattern-${emotion}`).value = currentThemeData.led[emotion].pattern;
                        document.getElementById(`led-speed-${emotion}`).value = currentThemeData.led[emotion].speed;
                        document.getElementById(`led-speed-value-${emotion}`).textContent = currentThemeData.led[emotion].speed;
                    }
                });
                
                hasChanges = false;
                updateSaveButtonState();
            }
            
            // Yardƒ±mcƒ± fonksiyonlar
            function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? 
                    [
                        parseInt(result[1], 16),
                        parseInt(result[2], 16),
                        parseInt(result[3], 16)
                    ] :
                    [0, 0, 0];
            }
            
            function rgbToHex(rgb) {
                return `#${((1 << 24) + (rgb[0] << 16) + (rgb[1] << 8) + rgb[2]).toString(16).slice(1)}`;
            }
            
            function compareObjects(obj1, obj2) {
                return JSON.stringify(obj1) === JSON.stringify(obj2);
            }
            
            function updateSaveButtonState() {
                saveButtons.forEach(btn => {
                    btn.disabled = !hasChanges;
                    btn.classList.toggle('disabled', !hasChanges);
                });
            }
            
            // √ñnizleme g√ºncellemesi (basit)
            const previewEmotion = document.getElementById('preview-emotion');
            previewEmotion.addEventListener('change', updatePreview);
            
            function updatePreview() {
                const emotion = previewEmotion.value;
                const previewFace = document.querySelector('.preview-face');
                const eyeLeft = previewFace.querySelector('.eye.left');
                const eyeRight = previewFace.querySelector('.eye.right');
                const mouth = previewFace.querySelector('.mouth');
                const ledStrip = document.querySelector('.led-strip');
                
                // G√∂z ayarlarƒ±
                const eyeData = currentThemeData.eyes[emotion];
                const eyeStyle = eyeData.style || 'cartoon';
                const pupilSize = eyeData.pupil_size || 0.3;
                const irisColor = eyeData.iris_color || [0, 0, 0];
                
                // Aƒüƒ±z ayarlarƒ±
                const mouthData = currentThemeData.mouth[emotion];
                const mouthStyle = mouthData.style || 'smile';
                const mouthWidth = mouthData.width || 0.6;
                const mouthHeight = mouthData.height || 0.3;
                
                // LED ayarlarƒ±
                const ledData = currentThemeData.led[emotion];
                const ledColor = ledData.color || [255, 255, 255];
                
                // CSS ile basit √∂nizleme uygula
                // (Ger√ßek uygulamada daha karma≈üƒ±k g√∂rseller olabilir)
                eyeLeft.style.backgroundColor = 'white';
                eyeRight.style.backgroundColor = 'white';
                
                // G√∂z bebeƒüi boyutu
                eyeLeft.style.setProperty('--pupil-size', pupilSize);
                eyeRight.style.setProperty('--pupil-size', pupilSize);
                
                // G√∂z bebeƒüi rengi
                eyeLeft.style.setProperty('--iris-color', `rgb(${irisColor[0]}, ${irisColor[1]}, ${irisColor[2]})`);
                eyeRight.style.setProperty('--iris-color', `rgb(${irisColor[0]}, ${irisColor[1]}, ${irisColor[2]})`);
                
                // Aƒüƒ±z stili (basitle≈ütirilmi≈ü)
                mouth.style.width = `${mouthWidth * 100}px`;
                mouth.style.height = `${mouthHeight * 50}px`;
                
                if (mouthStyle.includes('smile')) {
                    mouth.style.borderRadius = '0 0 100px 100px';
                } else if (mouthStyle.includes('frown')) {
                    mouth.style.borderRadius = '100px 100px 0 0';
                } else if (mouthStyle.includes('o')) {
                    mouth.style.borderRadius = '50%';
                } else {
                    mouth.style.borderRadius = '0';
                    mouth.style.height = '5px';
                }
                
                // LED rengi
                ledStrip.style.backgroundColor = `rgb(${ledColor[0]}, ${ledColor[1]}, ${ledColor[2]})`;
            }
            
            // Sayfa y√ºklendiƒüinde √∂nizlemeyi g√ºncelle
            updatePreview();
        });
    </script>
</body>
</html>